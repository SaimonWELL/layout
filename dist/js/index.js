document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("signup-button"),t=document.getElementById("popup"),n=document.getElementById("close-button"),d=document.getElementById("signup-form"),o=document.getElementById("thank-you");function s(e,t){const n=document.getElementById(`${e}-error`),d=document.getElementById(e),o=document.getElementById(`${e}-error-icon`);n&&d&&o&&(n.textContent=t,d.classList.add("error"),d.parentElement.classList.add("error"),o.style.visibility="visible")}function i(e){const t=document.getElementById(`${e}-error`),n=document.getElementById(e),d=document.getElementById(`${e}-error-icon`);t&&n&&d&&(t.textContent="",n.classList.remove("error"),n.parentElement.classList.remove("error"),d.style.visibility="hidden")}function a(e){e&&(localStorage.setItem("authToken",e),window.location.href=`https://www.dating.com/people/#token=${e}`)}e.addEventListener("click",(()=>{t.classList.remove("hidden")})),n.addEventListener("click",(()=>{t.classList.add("hidden")})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&t.classList.add("hidden")})),d.addEventListener("submit",(async e=>{e.preventDefault();const t=document.getElementById("email").value,n=document.getElementById("password").value;let r=!0;if(!function(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}(t)?(s("email","Please enter a valid e-mail"),r=!1):i("email"),n.length<8?(s("password","Password must be at least 8 characters"),r=!1):i("password"),!r)return;d.classList.add("hidden"),o.classList.remove("hidden");const c=await fetch("https://api.dating.com/identity",{method:"GET",headers:{Authorization:"Basic "+btoa(`${t}:${n}`)}});if(c.ok){return void a(c.headers.get("X-Token"))}const l=await fetch("https://api.dating.com/identity",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:n})});if(l.ok){const e=l.headers.get("X-Token");o.classList.remove("hidden"),d.classList.add("hidden"),setTimeout((()=>{a(e)}),2e3)}else s("form","Registration failed")})),window.addEventListener("load",(()=>{const e=localStorage.getItem("authToken");e&&a(e)}))}));